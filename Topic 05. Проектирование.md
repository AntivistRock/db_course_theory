# Проектирование

Этапы проектирования БД:

1. Определяем предметную область. Например, ритейл.
2. Разбиваем на не детализированные сущности. Например, чек покупки, продукт, магазин, ассортиментная матрица.
3. Определяем, как сущности будут друг с другом связаны:
   * Один к одному
   * Один ко многим
   * т.д.
4. Строим визуальную картину в ***ER***-нотации

Нотация "Воронья лапка"

* Сущность - прямоугольник, содержащий имя.
* Атрибуты сущности - внутри прямоугольника.
* Связь сущностей изображается линией.
* Множественность связи изображается в виде вилки.
* Необязательность связи помечается кружком.

##### Логическое проектирование

1. Разбиваем не детализированные сущности на детализированные согласно выбранной модели данных и нормализации.
2. Определяем атрибуты.
3. Определяем связи между сущностями по атрибутам.
4. Визуализируем БД в ER-нотации "Воронья лапка" (Crow's Food) с явным атрибутами.

##### Физическое проектирование

Физическое проектирование - создание схемы базы данных для конкретной *СУБД*. Специфика конкретной СУБД может включать в себя:

* Ограничения на именования объектов базы данных
* Ограничения на поддерживаемые типы данных
* Спецификация физической среды хранения:
  * Выбор методов управления дисковой памятью
  * Разделение БД по файлам и устройствам
  * Выбор методов доступа к данным
* Создание индексов

*Результатом* физического проектирования логической схемы может быть SQL-скрипт  создания таблицы и/или таблица с описанием по каждой сущности.

#### ER-диаграммы

Модель "сущность-связь" (*Entity-Relationship Model*, *ER-model*).

Основные элементы ER-диаграммы:

* *Сущность* (entity)
* *Атрибут* - свойство сущности (как правило, атомарное)
* *Ключевой атрибут* - уникальный атрибут, однозначно идентифицирующий экземпляр сущности.
* *Связь* (relationship) - ассоциация, устанавливаемая между сущностями. Степень связи - количество связанных сущностей.

При построении ER-моделей важно выделять типы бинарных связей, выделяют 4 типа связи:

![Нотация](/home/antivist/Pictures/Screenshot from 2023-04-10 13-57-07.png)

#### Нормальные формы

**Нормальная форма**:

* Список требований, который мы предъявляем к отношению, чтобы оно находилось в определенной *НФ*.
* Свойство отношения в реляционной модели данных, характеризующее степень его не оптимальности.

**Нормализация БД** - приведение к нормальной форме.

Нужна для:

* Минимизации логической избыточности
* Уменьшения потенциальной противоречивости - устранения некоторых *аномалий* обновления.
* Разработки проекта БД, который является:
  * Качественным представлением реального мира
  * Интуитивно понятным
  * Легко масштабируемым

Производится за счет декомпозиции отношения:

* Декомпозиция без потерь (правильная) - обратимая декомпозиция.

Аномалия - ситуация в таблице БД, возникшая из-за излишнего дублирования в таблице, такая, что:

* Существенно осложнена работа с БД
* В БД присутствуют противоречия

**Функциональная зависимость** между множествами атрибутов X и Y означает,  что для любого допустимого набора кортежей в данном отношении верно следующее: если два кортежа совпадают по значению X, то они совпадают по значению Y.

**Минимальная функциональная зависимость** — ни для одного из атрибутов мы не можем выделить подмножество в потенциальном ключе, такое, чтобы атрибут от него функционально зависел.

Виды нормальных форм:

* *Первая* *НФ* (*1NF*)

  Значения всех атрибутов атомарны (содержат только скаляры)

* *Вторая НФ* (*2NF*)

  *1NF* + каждый не ключевой атрибут минимально функционально зависит от потенциального ключа.

* Третья нормальная форма (*3NF*)

  *2NF* + каждый неключевой атрибут нетранзитивно функционально зависит от первичного ключа. Т.е. выносим в отдельные таблицы все не ключевые поля, содержание которых может относиться к нескольким записям таблицы.

#### Версионирование

**SCD** (*Slowly Changing Dimension*) - редко меняющиеся измерения.

* *0*:

  После попадания в таблицу данные не изменяются - нет поддержки версионности.

* *1*:

  Данные перезаписываются (всегда актуальные) - используется, если история не нужна.

* *2*:

  Храним историю с помощью двух полей - дата начала и окончания действия. *Используется наиболее часто*.

  *Достоинства:*

  - Хранит полную и неограниченную историю версий;
  - Удобный и простой доступ к данным необходимого периода.

  *Недостатки:*

  - Провоцирует на избыточность или заведение доп. таблиц для хранения изменяемых атрибутов.

  Вместо `NULL` используется некоторая константа (для `valid_to — '9999-12-31'`), что позволяет писать простые условия.

* *3*:

  Храним старое значение для выделенных атрибутов в отдельных полях. При получении новых данных старые данные перезаписываются текущими значениями.

  *Достоинства:*

  - Небольшой объем данных;
  - Простой и быстрый доступ к истории.

  *Недостатки:*

  - Ограниченная история.

* *4*:

  Актуальные данные в одной таблице, архивные в другой.

   Обычно используют для аудита изменений или создания архивных событий.

